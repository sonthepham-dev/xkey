name: Reopen Issue on New Comment

on:
  issue_comment:
    types: [created]

permissions:
  issues: write

jobs:
  reopen-if-closed:
    runs-on: ubuntu-latest
    # Only run when issue is closed and comment is not from a bot
    if: |
      github.event.issue.state == 'closed' &&
      github.event.comment.user.type != 'Bot'

    steps:
      - name: Reopen issue
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.update({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              state: 'open'
            });

            console.log(`âœ… Reopened issue #${context.issue.number}`);

      - name: Add comment explaining reopen
        uses: actions/github-script@v7
        with:
          script: |
            // Get repository info to check if commenter is the owner
            const repo = await github.rest.repos.get({
              owner: context.repo.owner,
              repo: context.repo.repo
            });

            const isOwner = context.payload.comment.user.login === repo.data.owner.login;

            // Only add comment if commenter is not the repo owner
            if (!isOwner) {
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                body: 'ðŸ”„ Issue Ä‘Ã£ Ä‘Æ°á»£c tá»± Ä‘á»™ng má»Ÿ láº¡i do cÃ³ comment má»›i tá»« @' + context.payload.comment.user.login
              });
              console.log(`âœ… Added reopen comment (commenter: @${context.payload.comment.user.login})`);
            } else {
              console.log(`â„¹ï¸ Skipped adding comment (commenter is repo owner: @${context.payload.comment.user.login})`);
            }

      - name: Summary
        run: |
          echo "âœ… Issue #${{ github.event.issue.number }} Ä‘Ã£ Ä‘Æ°á»£c reopen" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ‘¤ Comment tá»«: @${{ github.event.comment.user.login }}" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ”— Issue URL: ${{ github.event.issue.html_url }}" >> $GITHUB_STEP_SUMMARY
